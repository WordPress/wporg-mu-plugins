import*as e from"@wordpress/interactivity";var t={d:(e,r)=>{for(var s in r)t.o(r,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const r=(a={getContext:()=>e.getContext,store:()=>e.store},n={},t.d(n,a),n),{actions:s,state:o}=(0,r.store)("wporg/screenshot-preview",{state:{get attempts(){return(0,r.getContext)().attempts},get shouldRetry(){return(0,r.getContext)().shouldRetry},get hasError(){return(0,r.getContext)().hasError},get base64Image(){return(0,r.getContext)().base64Image},get hasLoaded(){return o.base64Image||o.hasError}},actions:{setShouldRetry(e){(0,r.getContext)().shouldRetry=e},setHasError(e){(0,r.getContext)().hasError=e},setBase64Image(e){(0,r.getContext)().base64Image=e},makeVisible(){(0,r.getContext)().isHidden=!1},*fetchImage(e){try{const t=(0,r.getContext)(),o=yield fetch(e);if(t.attempts++,o.redirected)s.setShouldRetry(!0);else if(200===o.status&&!o.redirected){const e=yield o.blob(),t=yield new Promise((t=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.readAsDataURL(e)}));s.setBase64Image(t),s.setShouldRetry(!1)}}catch(e){s.setHasError(!0),s.setShouldRetry(!1)}}},callbacks:{*init(){const{isHidden:e,src:t}=(0,r.getContext)();if(!e&&!o.base64Image)for(yield s.fetchImage(t);o.shouldRetry;)yield new Promise((e=>{setTimeout((()=>e()),2e3)})),yield s.fetchImage(t),o.attempts>=10&&(s.setHasError(!0),s.setShouldRetry(!1))}}});var a,n;